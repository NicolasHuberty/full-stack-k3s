apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: memo-app-production

namePrefix: prod-
nameSuffix: ""

resources:
  - ../../base

patches:
  - path: ingress-patch.yaml
  - path: replica-patch.yaml

images:
  - name: ghcr.io/nicolashuberty/memo-app
    newTag: production
  - name: ghcr.io/nicolashuberty/memo-worker
    newTag: production

labels:
  - pairs:
      environment: production

patches:
  - target:
      kind: Namespace
      name: memo-app
    patch: |-
      - op: replace
        path: /metadata/name
        value: memo-app-production
  - target:
      kind: ExternalSecret
      name: memo-secrets
    patch: |-
      - op: replace
        path: /spec/data/0/remoteRef/key
        value: memo-app/production
      - op: replace
        path: /spec/data/1/remoteRef/key
        value: memo-app/production
      - op: replace
        path: /spec/data/2/remoteRef/key
        value: memo-app/production
      - op: replace
        path: /spec/data/3/remoteRef/key
        value: memo-app/production
      - op: replace
        path: /spec/data/4/remoteRef/key
        value: memo-app/production
      - op: replace
        path: /spec/data/5/remoteRef/key
        value: memo-app/production
