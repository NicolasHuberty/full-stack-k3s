apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: memo-app-staging

namePrefix: staging-
nameSuffix: ""

bases:
  - ../../base

patchesStrategicMerge:
  - ingress-patch.yaml
  - replica-patch.yaml

images:
  - name: ghcr.io/nicolashuberty/memo-app
    newTag: staging
  - name: ghcr.io/nicolashuberty/memo-worker
    newTag: staging

commonLabels:
  environment: staging

patches:
  - target:
      kind: Namespace
      name: memo-app
    patch: |-
      - op: replace
        path: /metadata/name
        value: memo-app-staging
  - target:
      kind: ExternalSecret
      name: memo-secrets
    patch: |-
      - op: replace
        path: /spec/data/0/remoteRef/key
        value: memo-app/staging
      - op: replace
        path: /spec/data/1/remoteRef/key
        value: memo-app/staging
      - op: replace
        path: /spec/data/2/remoteRef/key
        value: memo-app/staging
      - op: replace
        path: /spec/data/3/remoteRef/key
        value: memo-app/staging
      - op: replace
        path: /spec/data/4/remoteRef/key
        value: memo-app/staging
      - op: replace
        path: /spec/data/5/remoteRef/key
        value: memo-app/staging
